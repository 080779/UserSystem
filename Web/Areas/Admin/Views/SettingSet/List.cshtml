<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/areas/admin/css/style.css" />
    <link href="~/assets/css/codemirror.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/assets/css/ace.min.css" />
    <link rel="stylesheet" href="~/assets/css/font-awesome.min.css" />
    <link href="~/areas/admin/css/page.css" rel="stylesheet" />
    <script src="~/assets/js/jquery.min.js"></script>
    <!--[if IE]>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <![endif]-->
    <!--[if !IE]> -->
    <script type="text/javascript">
        window.jQuery || document.write("<script src='/assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
    </script>
    <!-- <![endif]-->
    <script type="text/javascript">
        if ("ontouchend" in document) document.write("<script src='/assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script type="text/javascript" src="~/areas/admin/js/vue.min2.5.16.js"></script>
    <script type="text/javascript" src="~/areas/admin/js/vue-resource.min1.5.0.js"></script>
    <script src="~/assets/js/bootstrap.min.js"></script>
    <script src="~/assets/js/typeahead-bs2.min.js"></script>
    <!-- page specific plugin scripts -->
    <script src="~/assets/js/jquery.dataTables.min.js"></script>
    <script src="~/assets/js/jquery.dataTables.bootstrap.js"></script>
    <script type="text/javascript" src="~/areas/admin/js/H-ui.js"></script>
    <script type="text/javascript" src="~/areas/admin/js/H-ui.admin.js"></script>
    <script src="~/assets/layer/layer.js" type="text/javascript"></script>
    <script src="~/assets/laydate/laydate.js" type="text/javascript"></script>
    @*<script src="~/assets/src/laydate.js"></script>*@
    <script src="~/areas/admin/js/wangEditor.min.js"></script>
    <script src="~/areas/admin/js/jquery.uploadimg.js"></script>
    <title>参数列表</title>
</head>

<body>
    <div id="app">
        <div class="changeall"><a v-on:click="editall" class="btn btn-primary">修改全部</a></div>
        <div class="changelists" v-for="settingSet in settingSets">            
            <div class="changelist">
                <div v-for="set in settingSet.settings">
                    <div class="changelisttitle"><span v-if="set.sort==0" style="color:red;" v-html="settingSet.typeName+'>>'"></span></div>
                    <span class="changetitle" v-html="set.name+'：'"></span><input type="text" v-model="set.parm" /><span class="changeremark" v-html="set.description"></span>
                    <span><button v-on:click="edit(set.id,set.parm)" class="btn-success">修改</button></span>
                </div>
            </div>
            <hr />
        </div>
        <div class="changeall"><a v-on:click="editall" class="btn btn-primary">修改全部</a></div>
    </div>
    <script type="text/javascript">
        var startTime;
        var endTime;
        var settings = new Array();
        var vue = new Vue({
            el: "#app",
            data: {
                settingSets: []
            },
            methods: {
                getpage: function () {
                    this.$http.post('/admin/settingset/list', {}, { emulateJSON: true }).then(function (result) {
                        this.settings = result.data.data;
                    })
                },
                edit: function (id,parm) {
                    this.$http.post('/admin/settingset/edit', { id:id,parm:parm }, { emulateJSON: true }).then(function (result) {
                        if (result.data.status == 1) {
                            layer.alert(result.data.msg, { icon: 6, title: '提示框' });
                            this.getpage();
                        }
                        else if (result.data.status == 0) {
                            layer.alert(result.data.msg, { icon: 0, title: '提示框' });
                        }
                        else if (result.data.status == 302) {
                            window.location.href = result.data.data;
                        }
                        else if (result.data.status == 401) {
                            layer.alert(result.data.msg, { icon: 6, title: '提示框' });
                        }
                    })
                },
                editall: function () {
                    $.each(this.settingSets, function (k, val) {
                        $.each(val.settings, function (key, value) {
                            var setting = { id: 0, parm: '' };
                            setting.id = value.id;
                            setting.parm = value.parm;
                            settings.push(setting);
                        })
                    })
                    this.$http.post('/admin/settingset/editall', { settings: settings }, { emulateJSON: true }).then(function (result) {
                        if (result.data.status == 1) {
                            layer.alert(result.data.msg, { icon: 6, title: '提示框' });
                            this.getpage();
                        }
                        else if (result.data.status == 0) {
                            layer.alert(result.data.msg, { icon: 0, title: '提示框' });
                        }
                        else if (result.data.status == 302) {
                            window.location.href = result.data.data;
                        }
                        else if (result.data.status == 401) {
                            layer.alert(result.data.msg, { icon: 6, title: '提示框' });
                        }
                    })
                }
            },
            mounted: function () {
                this.$http.post('/admin/settingset/list', {}, { emulateJSON: true }).then(function (result) {
                    this.settingSets = result.data.data;
                })
            }
        });
    </script>
</body>
</html>

